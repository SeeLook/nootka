appimage-amd64:
  only:
    variables:
      - $CI_COMMIT_MESSAGE =~ /prepare_build/

  image: ubuntu:16.04

  before_script:
    - apt-get update
    - apt-get install -y mesa-common-dev libsoundtouch-dev libfftw3-dev libasound2-dev libogg-dev libvorbis-dev libpulse-dev libjack-dev cmake git wget build-essential software-properties-common
    - add-apt-repository -y -u ppa:beineri/opt-qt-5.12.10-xenial
    - apt-get install -y qt512base qt512graphicaleffects qt512translations qt512x11extras qt512tools libgl1-mesa-glx libgl1-mesa-dri qt512quickcontrols2 qt512quickcontrols libgl1-mesa-dev

  script:
    - . "/opt/qt512/bin/qt512-env.sh" || true
    - cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr -DWITH_STATIC_LIB=ON -DQT_QMAKE_EXECUTABLE=/opt/qt512/bin/qmake .
    - make
    - make appimage

  artifacts:
    name: "Nootka-AppImage-$(head -1 $PWD/changes | sed 's/\ /-/g')-b$(git rev-list HEAD --count)"
    paths:
      - 'nootka-*.AppImage*'
